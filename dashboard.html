<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <header>
    <h1>Admin Dashboard</h1>
    <a href="admin.html">Log out</a>
  </header>

  <section>
  <h2>Bookings</h2>
  <table border="1">
    <thead>
      <tr>
        <th>Full Name</th>
        <th>Phone</th>
        <th>Location</th>
        <th>Service</th>
        <th>Car Size</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="bookings-list">
      <tr><td colspan="6">Loading...</td></tr>
    </tbody>
  </table>
</section>


  <script>
async function loadDashboardData() {
  try {
    // Fetch bookings
    const bookingsRes = await fetch('https://carwash-backend-1-2urg.onrender.com/api/admin/bookings');
    const bookings = await bookingsRes.json();

    const bookingsDiv = document.getElementById('bookings-list');
    bookingsDiv.innerHTML = `
      <table border="1">
        <tr>
          <th>Full Name</th>
          <th>Phone</th>
          <th>Location</th>
          <th>Service</th>
          <th>Car Size</th>
          <th>Action</th>
        </tr>
        ${bookings.map(b => `
          <tr>
            <td>${b.fullName}</td>
            <td>${b.phone}</td>
            <td>${b.location}</td>
            <td>${b.service}</td>
            <td>${b.carSize}</td>
            <td><button onclick="deleteBooking('${b._id}')">Delete</button></td>
          </tr>
        `).join('')}
      </table>
    `;

    // Fetch contact messages
    const contactsRes = await fetch('https://carwash-backend-1-2urg.onrender.com/api/admin/contacts');
    const contacts = await contactsRes.json();

    const contactsDiv = document.getElementById('contact-messages');
    contactsDiv.innerHTML = contacts.map(c => `
      <div>
        <strong>${c.name}</strong> - ${c.email}<br>
        ${c.message}
      </div>
    `).join('');

  } catch (error) {
    console.error("Error loading data", error);
    alert("Error loading data");
  }
}

async function deleteBooking(id) {
  const confirmDelete = confirm("Are you sure you want to delete this booking?");
  if (!confirmDelete) return;

  try {
    const res = await fetch(`https://carwash-backend-1-2urg.onrender.com/api/admin/bookings/${id}`, {
      method: 'DELETE'
    });

    if (res.ok) {
      alert("Booking deleted.");
      loadDashboardData(); // Refresh the data
    } else {
      alert("Failed to delete booking.");
    }
  } catch (err) {
    console.error("Delete failed", err);
    alert("Error deleting booking.");
  }
}

loadDashboardData();
</script>


  <script src="dashboard.js"></script>
</body>
</html>
