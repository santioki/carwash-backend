<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
 <body>
  <h2>Bookings</h2>
  <div id="bookings-list"></div>

  <h2>Contact Messages</h2>
  <div id="contact-messages"></div>

  <script>
    async function loadDashboardData() {
      try {
        // Fetch bookings
        const bookingsRes = await fetch('https://carwash-backend-1-2urg.onrender.com/api/admin/bookings');
        const bookings = await bookingsRes.json();

        const bookingsDiv = document.getElementById('bookings-list');
        bookingsDiv.innerHTML = `
          <table border="1">
            <tr>
              <th>Full Name</th>
              <th>Phone</th>
              <th>Location</th>
              <th>Service</th>
              <th>Car Size</th>
              <th>Action</th>
            </tr>
            ${bookings.map(b => `
              <tr>
                <td>${b.fullName}</td>
                <td>${b.phone}</td>
                <td>${b.location}</td>
                <td>${b.service}</td>
                <td>${b.carSize}</td>
                <td><button onclick="deleteBooking('${b._id}')">Delete</button></td>
              </tr>
            `).join('')}
          </table>
        `;

        // Fetch contact messages
        const contactsRes = await fetch('https://carwash-backend-1-2urg.onrender.com/api/admin/contacts');
        const contacts = await contactsRes.json();

        const contactsDiv = document.getElementById('contact-messages');
        contactsDiv.innerHTML = contacts.map(c => `
          <p><strong>${c.name}</strong>: ${c.message} (${c.email})</p>
        `).join('');
        
      } catch (err) {
        console.error('Error loading dashboard data:', err);
      }
    }

    async function deleteBooking(id) {
      try {
        const res = await fetch(`https://carwash-backend-1-2urg.onrender.com/api/admin/bookings/${id}`, {
          method: "DELETE"
        });
        if (res.ok) {
          alert("Booking deleted.");
          location.reload();
        } else {
          alert("Failed to delete booking.");
        }
      } catch (err) {
        console.error("Error deleting booking:", err);
        alert("Error deleting booking.");
      }
    }

    // Load everything
    loadDashboardData();
  </script>
</body>

</script>


  <script src="dashboard.js"></script>
</body>
</html>
